.Random.seed <-
c(403L, 10L, -323786906L, 1585366017L, -2017054061L, 1066718530L, 
1036598004L, -270088457L, 1270122221L, -115617404L, -115941462L, 
-1851562731L, -1775562833L, 1974894518L, 2032281056L, -932643549L, 
-149515711L, 681852208L, -1736485042L, -1197457991L, 117333963L, 
-812346246L, 1237845372L, -99181121L, -1368597867L, -2028107604L, 
-1451371902L, -2134615459L, 1285229911L, 1065644094L, -39238536L, 
-1615147173L, 427129529L, -1460234488L, -793170506L, -623922447L, 
2112206115L, 167309170L, 161643972L, 1109902727L, 406980445L, 
216861012L, -2086925446L, -1175049531L, 245169183L, -93140058L, 
642207024L, -965480493L, 475946481L, -423187680L, 376669630L, 
-81691191L, -718380677L, 477308746L, -159778900L, 1658437295L, 
965688421L, 1810164764L, 866845298L, -1390201619L, -893932249L, 
722655566L, -1769096792L, 314146219L, -65366327L, 1215287000L, 
-296348794L, 751912545L, 220266483L, -2012941726L, -1363557164L, 
-769022505L, 64737229L, 863505252L, 1052135242L, -1164159307L, 
1885326863L, 1466605334L, 940132800L, 53270915L, 182214561L, 
-1871409264L, -1160842130L, -1026784743L, -1221014869L, 200773274L, 
1013910108L, -557672609L, 443001141L, -1831499572L, -1045335518L, 
-319591299L, 311334263L, -926229858L, 960919896L, -1827258181L, 
-1159037351L, 378097128L, -36661226L, -1357732975L, 2050395203L, 
-11738286L, -1115592732L, -916875737L, 1626926717L, 983158644L, 
1343136602L, 30365093L, -1699491393L, -637658554L, -637552432L, 
-321432845L, 383648785L, -1590783424L, -1794111970L, 1066291433L, 
1494577691L, -430271958L, -182586036L, -1275701489L, -1703290299L, 
-947270660L, 894489170L, -1593790515L, -288642681L, -470082450L, 
1243915336L, -1024360885L, 901870505L, -863814920L, 1532530214L, 
636413761L, -38556461L, -2038681470L, -266924364L, -1691276745L, 
1966813485L, -1987476924L, 341712746L, -1159664683L, 1537043823L, 
1252268150L, 1257452448L, -755604381L, -680693503L, 507788400L, 
-1496877042L, -136411015L, -564426741L, 1626925370L, -2125924292L, 
-2118373505L, 1480467669L, -375916308L, -1485753790L, -1741843043L, 
614010903L, -703036034L, -1086285000L, 2002969627L, 616185209L, 
1436634056L, 2077415414L, 1579776561L, 1121250403L, -806202318L, 
706670980L, 1521607L, 1433647773L, -1355412972L, -31135558L, 
-310495995L, -1866260769L, 1441538918L, -355286288L, 1574986259L, 
-1564456015L, 1351808608L, -1314737154L, 561720201L, -1260012357L, 
-1135691638L, -774706324L, 1050906863L, -301515995L, -1308711460L, 
1888666546L, 84290221L, -1683062169L, -251289202L, 1948673640L, 
-1169206677L, 2122984457L, 1687769752L, 1363830214L, -1672731359L, 
330581427L, 2033209634L, -1686426860L, 953406359L, -1497474163L, 
-70474076L, 1680230538L, 1340518133L, 1734848847L, -1854276010L, 
997418240L, -1796030397L, 2116350945L, -38483120L, 1354210734L, 
416969561L, -468928149L, 841507034L, -1838904932L, -1018292833L, 
-1525422091L, -1967921524L, -1842015390L, 731429693L, 613723063L, 
305651806L, 1596243352L, -220043013L, -1793559399L, -799091416L, 
-1991920682L, 1533421649L, 2017716995L, -909160244L, -847232516L, 
-1153695822L, -514550288L, 1564650948L, 1263269720L, 1295997818L, 
365657520L, -1922809412L, 1733189716L, -1394412606L, -45915360L, 
252581820L, 1127133776L, -1661178398L, -396332696L, -687878836L, 
1600643324L, 1152926450L, 1749446400L, 1065582196L, 698793992L, 
-1981795910L, 1626181584L, -279180820L, 627287956L, 16405202L, 
-1646985632L, -1024367284L, 314852640L, 1195289218L, 1568512488L, 
-992919572L, 1901610556L, 1509246578L, -506549392L, 1595189540L, 
-1791450568L, 237361562L, -1012844080L, -869866052L, 627693716L, 
629994626L, 932816320L, 231017276L, 1704455312L, 874060578L, 
431060488L, 1827382540L, 604304796L, -474894830L, -275645568L, 
-2026712300L, -1794068184L, 1052312634L, -850744368L, 435706476L, 
1283363380L, -823076206L, -1273076384L, -2074764980L, -1173346336L, 
-566463070L, -1484982872L, -1417652596L, -1493615172L, 1270140530L, 
767325168L, -765710780L, 280440920L, 531281978L, -342155152L, 
1658247228L, 1528078612L, 965141186L, -1734449440L, 2028894332L, 
-230607152L, 1414035874L, 569354280L, -1366750452L, 2126858684L, 
-942189774L, -423822656L, 866888756L, 1151250120L, 1687467194L, 
358667920L, -1341563156L, 577473108L, 460862098L, 2033350944L, 
903512524L, 16278240L, -1200426814L, -1383928792L, -2002626644L, 
120380092L, 19205106L, 1920792112L, -905592924L, 483216824L, 
353126234L, -1455943536L, 58801020L, -736419564L, -578635454L, 
1830043904L, -373731908L, 1298850128L, 188979490L, 759388744L, 
-684969972L, -1450256804L, 1943275986L, 1934652928L, -465963692L, 
655600872L, -1518976774L, 999876304L, 355240748L, 362090740L, 
-21931630L, 1514929504L, 733350924L, 1723464928L, 1957536354L, 
689816744L, 1873886284L, -746907780L, -475440846L, 1887490672L, 
-790064316L, 127874008L, 1392919418L, 551077936L, 271445948L, 
1191240276L, 1119473730L, -291541344L, 1669243580L, 204032976L, 
-1924997790L, -1759666456L, -1477985076L, 992694780L, -33882638L, 
-2001582976L, -341980684L, 180132488L, 99191610L, 2030652752L, 
-1212486548L, 1787979156L, 1954103378L, 954793440L, -1008356148L, 
-1916756320L, 1658163586L, -1936148248L, 271858412L, -936254148L, 
283283570L, 50713200L, 601672228L, -265332680L, 1139042586L, 
1458013392L, -1440921284L, 882287508L, -1417922686L, -93434944L, 
-126499268L, -350101104L, -841607134L, -1557650168L, -771549044L, 
-772894948L, -1778502510L, 1415124352L, -644427756L, -1232365784L, 
-1181718982L, 1509503440L, 1111521644L, -1122733132L, -1852028398L, 
792750048L, 182905292L, 1952823520L, 568790050L, -1463938264L, 
1230772748L, 1796145980L, 742809586L, -1169313040L, -482108860L, 
-1234407848L, -1326344390L, 449261552L, 439018172L, -1475275500L, 
1449860290L, 1375038560L, 2081174908L, 92262352L, 590962978L, 
1197020840L, 48068492L, -1770916676L, -893973710L, -845838784L, 
-658926412L, 284542024L, -343325254L, 2111547920L, -561382164L, 
-913047212L, 1709896466L, -26407520L, 1643412172L, 1162361440L, 
-1792450622L, 1488466728L, -1000220244L, -932844228L, 765082482L, 
263538542L, -447824132L, 226917485L, -68827113L, -67505696L, 
1481833918L, -810122357L, 349320205L, 668423226L, 1028396152L, 
1575157793L, -162395437L, -12547596L, 252064386L, 239013655L, 
-1234336287L, 886553382L, 359413284L, -510857003L, 594219135L, 
-1528019688L, 1393605686L, 1413882563L, 1629654789L, 16237218L, 
748843152L, -1495629767L, -548196117L, 556900828L, 1719199754L, 
-1556228353L, 1426327369L, 147504350L, 1017733772L, -1923439011L, 
-1631179673L, -1445248624L, -1347264082L, -1483844517L, -95304643L, 
904071850L, 2004203336L, -557057167L, 841252067L, -1023601692L, 
1147666L, -1564258585L, 1596930225L, -794920202L, 926457108L, 
462389797L, -737538257L, 1170518248L, -67382842L, -1058602893L, 
-780506411L, -1926481742L, 771828864L, 207007849L, -1843172133L, 
1598513196L, -1264885702L, 121396975L, -182357639L, 1274682894L, 
-1225646116L, -1632298931L, 1763523511L, 625861952L, 1631249438L, 
-268270869L, -2080052627L, -242533670L, 1991107224L, -371498751L, 
-1485797709L, -1780084268L, -1150189342L, -2043365001L, 1679255745L, 
1567028294L, 387947396L, 1841351989L, -1836123361L, -224276872L, 
1964585814L, -677103133L, 852447141L, 1654361666L, 597554224L, 
-1757231015L, 1747887563L, -454171076L, 1891915882L, 1221042847L, 
-1718390999L, 1225200574L, 1252270764L, -612708355L, 1622890311L, 
1569413168L, 1468232014L, -1884178053L, -720781603L, -1117325558L, 
-1260401112L, 698324625L, 1063534211L, 1252212612L, 985249202L, 
-702063865L, 317329745L, 274655446L, -1361197644L, -1012071995L, 
1550569743L, 2088685448L, 128229030L, 250728019L, 986673077L, 
-2107892462L, 42403552L, 488069961L, 1421391227L, -1456758708L, 
1673689562L, -2092780593L, 1564237209L, -94788178L, -911363396L, 
816616237L, 105332951L, 453626144L, 2003357310L, -971802549L, 
1600807501L, -166559622L, 304844984L, -1069784479L, -762193901L, 
-139168204L, 70451266L, 1245478999L, -903449695L, 532526182L, 
1614445668L, 492337045L, -977887041L, 576028760L, 2048558198L, 
-545878909L, 893246661L, 765491682L, 1814880336L, -195960455L, 
694466219L, 580591132L, -2110408374L, -1717765825L, -1820229751L, 
-1223090274L, -1974350260L, -1119004643L, 1625868711L, -772518704L, 
-778547602L, -1191601893L, 1992899197L, 283082858L, 1120866343L
)


# Helper Tool for Generating Placebos

syn<-function(i,
							foo,
							predictors,
							predictors.op,
							dependent,
							unit.variable,
							time.variable,
							special.predictors,
							treated.units,
							control.units,
							time.predictors.prior,
							time.optimize.ssr,
							unit.names.variable,
							time.plot,
							Sigf.ipop){
	dataprep.out<-Synth::dataprep(
		foo = foo,
		predictors = predictors,
		predictors.op = predictors.op,
		dependent = dependent,
		unit.variable = unit.variable,
		time.variable = time.variable,
		special.predictors = special.predictors,
		treatment.identifier = treated.units[[i]],
		controls.identifier = control.units,
		time.predictors.prior = time.predictors.prior,
		time.optimize.ssr = time.optimize.ssr,
		unit.names.variable = unit.names.variable,
		time.plot = time.plot)
	
	synth.out<-Synth::synth(dataprep.out, 
													Sigf.ipop = Sigf.ipop)
	
	a<-data.frame(dataprep.out$Y0plot %*% synth.out$solution.w)
	
	colnames(a)<-paste('unit',i,sep='')
	
	out<-list(a = a, synth.out=synth.out, dataprep.out = dataprep.out)
	
	return(out)
}

# Function used in generate,placebos
# 
syn_plac <- function(i, 
										 dataprep.out, 
										 Sigf.ipop, 
										 tr, 
										 names.and.numbers) {
	cases <- as.numeric(dataprep.out$tag$controls.identifier)
	X0 <- dataprep.out$X0[, -i]
	X1 <- matrix(dataprep.out$X0[, i, drop = F])
	Z0 <- dataprep.out$Z0[, -i]
	Z1 <- matrix(dataprep.out$Z0[, i, drop = F])
	Y0plot <- dataprep.out$Y0plot[, -i]
	Y1plot <- dataprep.out$Y0plot[, i, drop = F]
	foo <- character(length = length(dataprep.out$tag$foo))
	id <- as.numeric(dataprep.out$tag$unit.variable)
	d <-
		which(regexpr(tr, stringr::str_split(dataprep.out$tag$foo[id],
																				 ', ')[[1]]) == T)
	for (j in 1:length(dataprep.out$tag$foo)) {
		foo[j] <-
			paste(stringr::str_split(dataprep.out$tag$foo[j],
															 ', ')[[1]][-c(d[1]:d[length(d)])], 
						collapse =', ')
	}
	predictors <- dataprep.out$tag$predictors
	predictors.op <- dataprep.out$tag$predictors.op
	special.predictors <- dataprep.out$tag$special.predictors
	dependent <- dataprep.out$tag$dependent
	unit.variable <- dataprep.out$tag$unit.variable
	time.variable <- dataprep.out$tag$time.variable
	treatment.identifier <- i
	controls.identifier <- dataprep.out$tag$controls.identifier[-i]
	time.predictors.prior <- dataprep.out$tag$time.predictors.prior
	time.optimize.ssr <- dataprep.out$tag$time.optimize.ssr
	time.plot <- dataprep.out$tag$time.plot
	unit.names.variable <- dataprep.out$tag$unit.names.variable
	tag <- list(
		foo = as.character(foo),
		predictors = predictors,
		predictors.op = predictors.op,
		special.predictors = special.predictors,
		dependent = dependent,
		unit.variable = unit.variable,
		time.variable = time.variable,
		treatment.identifier = treatment.identifier,
		controls.identifier = controls.identifier,
		time.predictors.prior = time.predictors.prior,
		time.optimize.ssr = time.optimize.ssr,
		time.plot = time.plot,
		unit.names.variable = unit.names.variable
	)
	dp <- list(
		X0 = X0,
		X1 = X1,
		Z0 = Z0,
		Z1 = Z1,
		Y0plot = Y0plot,
		Y1plot = Y1plot,
		names.and.numbers = names.and.numbers,
		tag = tag
	)
	s.out <- Synth::synth(data.prep.obj = dp, 
												Sigf.ipop = Sigf.ipop)
	a <- data.frame(dp$Y0plot %*% s.out$solution.w)
	s.mspe <- s.out$loss.v
	res <- list(a = a, s.mspe = s.mspe)
	return(res)
}

# Pattern Matching on T/F arguments

match_logical <- function(x){
	
	x <- as.character(x)
	
	out <- try(grepl(pattern = "T", x = x, ignore.case = T))
	
	if(class(out) == "try-error"){
		stop("Please pass a logical (i.e. TRUE or FALSE)")
	}
	
	out
}

# Names of objects in `Synth`

synth_object_names <- c("solution.v",
												"solution.w",
												"loss.v",
												"loss.w",
												"custom.v",
												"rgV.optim")

dataprep_object_names <- c( "X0", 
														"X1", 
														"Z0",
														"Z1",
														"Y0plot",
														"Y1plot",
														"names.and.numbers",
														"tag" )




